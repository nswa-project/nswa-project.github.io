<!DOCTYPE html><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>NSWA Ranga Web</title><meta name=viewport content="width=device-width,initial-scale=1"><style>body{margin:20px;margin-left:100px;margin-right:100px;font-family:sans-serif;padding-left:340px}body{--code-background:#f9f9f9;--code-font-size:15px;--code-font-family:'Roboto Mono','Ubuntu Mono','Noto Sans Mono',Consolas,Menlo,Monaco,'Lucida Console','DejaVu Sans Mono','Bitstream Vera Sans Mono',monospace}a{color:#08c;text-decoration:none;outline:0}a:hover{color:#005580;text-decoration:none;outline:0}a:active,a:hover{outline:0}a:focus{outline:0}p{word-wrap:break-word}div.sourceCode{display:inline}pre{padding:10px;background-color:var(--code-background);overflow:auto;font-size:var(--code-font-size);font-family:var(--code-font-family)}pre>code{font-size:var(--code-font-size);font-family:var(--code-font-family)}:not(pre)>code{background-color:var(--code-background);padding:4px;font-size:var(--code-font-size);font-family:var(--code-font-family)}blockquote{margin-left:10px;border-left:5px solid #afafaf;padding-left:10px;color:#464646}table{border-width:1px;border-color:#464646;border-collapse:collapse}table th{border-width:1px;padding:8px;border-style:solid;border-color:#464646;background-color:#eaeaea}table td{border-width:1px;padding:8px;border-style:solid;border-color:#464646;background-color:#fff}#FontLoading{display:none;position:fixed;z-index:999;top:50px;right:20px;max-width:300px;background-color:#ffc;padding:10px;box-shadow:0 0 10px 0 #afafaf}#TOC{background-color:var(--code-background);height:100%;width:340px;max-width:340px;position:fixed;overflow:scroll;overflow-x:auto;left:0;top:0}#TOC_MoblieHelper{padding:6px;display:none;position:fixed;left:0;top:0;background:#fff}@media (max-width:980px){body{margin:10px;margin-left:10px;margin-right:10px}}@media (max-width:720px){body{margin:10px;padding-top:30px;padding-left:0;padding-right:0}#TOC{height:unset;width:unset;max-width:unset;position:unset;overflow:unset;display:none}#TOC_MoblieHelper{display:block}}img{margin:20px 0}.box_warn{border:1px solid #d1d5da;background-color:#ffc;padding:8px;margin:8px}</style><div id=TOC_MoblieHelper><a href=# onclick='document.getElementById("TOC").style.display="block",document.getElementById("TOC_MoblieHelper").style.display="none"'>显示目录</a></div><div id=FontLoading>正在从 Google Fonts 加载字体<br>如果你长时间无法加载字体，则说明你的网络连接或者 DNS 可能有问题</div><div class=box_warn>警告：该文档是从旧文档树中经过简单整理直接发布的，由于当前文档缺乏维护，因此对于当前开源版本主线 NSWA Ranga 可能少部分内容有所过时。如果你发现问题，请前往<a href=https://github.com/nswa-project/website/issues target=_blank>bugtracer</a>提交错误报告。</div><div id=TOC><ul><li><a href=#nswa-ranga-数据交换协议>NSWA Ranga 数据交换协议</a><ul><li><a href=#数据交换协议是纯文本的>数据交换协议是纯文本的</a><ul><li><a href=#为何不采用返回-json-的-rest-api>为何不采用返回 JSON 的 REST API ？</a></ul><li><a href=#头部字段>头部字段</a><ul><li><a href=#code>code</a><li><a href=#error-origin>error-origin</a><li><a href=#content-type>content-type</a><li><a href=#disp-section>disp-section</a><li><a href=#token-meta>token-meta</a><li><a href=#target-notfount>target-notfount</a></ul></ul></ul></div><h1 id=nswa-ranga-数据交换协议>NSWA Ranga 数据交换协议</h1><h2 id=数据交换协议是纯文本的>数据交换协议是纯文本的</h2><h3 id=为何不采用返回-json-的-rest-api>为何不采用返回 JSON 的 REST API ？</h3><p>或许对某些客户端来说使用这些技术可以节省成本，但是 NSWA Ranga 的服务器和客户端充斥大量 Shell 脚本，尤其是服务端为了照顾小闪存设备不方面安装像 jshon 等 shell 脚本 json 解析器。因此 NSWA Ranga 使用非常朴实的纯文本。<p>数据交换协议类似于 HTTP/1.1，它具有一个头部（header）和剩余的载荷（payload）<pre><code>key: value\n
key: value\n
key: value\n
\n
payload</code></pre><p>和 HTTP 协议不同之处在于，NSWA Ranga 数据交换协议没有专门的协议版本而倾向于使用 key-value 对进行自我描述，NSWA Ranga 数据交换协议使用<code>\n</code>UNIX 换行符而不是 HTTP 的<code>\r\n</code>DOS 换行符。<p>数据交换协议头部必须使用 UTF-8 编码。除非存在<code>content-encoding</code>或<code>content-type</code>头部指明，否则文本格式的 payload 必须使用 UTF-8 编码。实现可以不实现其他编码支持。<h2 id=头部字段>头部字段</h2><p>只有<code>code</code>是必须字段，其他字段均为可选字段<p>以下字段被保留并且必须不出现，实现可以假定这些字段不会出现<ul><li><p>payload<li><p>ranga<li><p>以下划线<code>_</code>开头的任何字段</ul><h3 id=code>code</h3><p>操作的状态吗。请参考<a href=intro-cmdline.html>命令行工具手册</a>中的“NSWA Ranga 系统错误代码”节。<p>客户端必须检查此状态码。并应该在非 0 状态码时显示相应的错误信息。<h3 id=error-origin>error-origin</h3><p>指定错误的起源<ul><li><p>invoke-ext<p>表明 code 是在试图通过“Ranga 扩展程序统一 API 调用接口”调用某个扩展程序，但是却没有成功唤起扩展程序，例如扩展程序不存在、扩展程序未提供此 API 等。</ul><h3 id=content-type>content-type</h3><p>指示 payload 的类型，并可能影响客户端的后续操作。<ul><li><p>dispTargetsList<p>表明 payload 是执行像<code>ranga-cli config</code>这样带有子命令（目标）的命令，服务器检查自己支持哪些子命令（目标）并展示出来，此时 payload 是一个以<code>\n</code>UNIX 换行符分割的列表。同时会附带<code>disp-section</code>字段。<li><p>dispOutput<p>表明 payload 是执行像<code>ranga-cli config &lt;section&gt; ...</code>这样带有子命令（目标）的命令，经过转发之后的 section 的输出。<li><p>authToken<p>表明 payload 是执行鉴权后的 Token。同时会附带<code>token-meta</code>字段。服务器返回的 Token 数据中必须不出现<code>\n</code>UNIX 换行符字节、<code>\r</code>回车符字节、<code>\</code>字节、<code>&amp;</code>字节和<code>%</code>字节，以便客户端实现可以保证这一点。<li><p>extInstaller<p>表明 payload 是扩展程序安装辅助程序的原始输出。<li><p>extensionManifest<p>表明 payload 是一个扩展程序的清单文件<li><p>extensionsList<p>表明 payload 是一系列扩展程序的列表，此时 payload 是一个以<code>\n</code>UNIX 换行符分割的列表。<li><p>extensionAPI<p>表明 payload 是通过“Ranga 扩展程序统一 API 调用接口”调用的扩展程序的输出。<li><p>componentsList<p>表明 payload 是已部署的系统组件的列表和这些组件的详细信息。每个组件的开始行符合此正则表达式<code>^COMPONENT UUID \(.*\)$</code><li><p>octetStream<p>二进制数据，客户端的行为由实现定义。</ul><h3 id=disp-section>disp-section</h3><p>当<code>content-type</code>为<code>dispTargetsList</code>指明 section 类型，例如<code>ranga-cli config</code>中 section 为<code>config</code><h3 id=token-meta>token-meta</h3><p>Token 的元数据，每条以<code>;</code>分割。<pre><code>v1;ascii64;octet</code></pre><p>v1 - 版本 1<p>ascii40 - Token 由 40 个 ASCII 字符组成<p>ascii64 - Token 由 64 个 ASCII 字符组成<p>octet - 使用 8 位字节存储 ASCII 数据，否则为 7 位字节<p>实现应该检查此字段，如果实现不检查此字段，则必须将 Token 视为 Blob 使用。<h3 id=target-notfount>target-notfount</h3><p>为 true 表明 payload 是执行像<code>ranga-cli config</code>这样带有子命令（目标）的命令，但是目标不存在</p><script>document.getElementById("FontLoading").style.display="block";var link=document.createElement("link");link.setAttribute("rel","stylesheet"),link.type="text/css",link.href="https://fonts.googleapis.com/css?family=Roboto+Mono",document.head.appendChild(link),link.onload=function(){document.getElementById("FontLoading").style.display="none"},link.onerror=function(){document.getElementById("FontLoading").style.backgroundColor="#ffe2e2",document.getElementById("FontLoading").innerHTML="无法从 Google Fonts 加载字体，你的网络连接或者 DNS 可能有问题"}</script>